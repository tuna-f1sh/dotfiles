#!/bin/bash
# Enable or disable target power on the Black Magic Probe
#
# Usage: bmp-tpwr [enable|disable]
option=${1:-enable}
probe=${2:-/dev/ttyBmpGdb}

if [ ! -e "$probe" ]; then
  probe=$(cyme --vidpid=0x1d50:0x6018 --json | jq '.[] | .extra.configurations[].interfaces[0].devpaths | select(. !=null)[0]' | tr -d '"')
fi

if [ ! -e "$probe" ]; then
  echo "Black Magic Probe not found"
  exit 1
fi

arm-none-eabi-gdb -ex "target extended-remote $probe" -ex "monitor tpwr $option" -ex "quit"
