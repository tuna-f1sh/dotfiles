#!/bin/bash
# Enable or disable target power on the Black Magic Probe
#
# Usage: bmp-tpwr [enable|disable]

option=${1:-enable}
device=/dev/ttyBmpGdb

if [ ! -e $device ]; then
  if [ "$(uname)" == "Darwin" ]; then
    device=$(find /dev/cu.usbmodem* | head -n 1)
  else
    device=/dev/ttyACM0
  fi
fi

if [ ! -e $device ]; then
  echo "Black Magic Probe not found"
  exit 1
fi

arm-none-eabi-gdb -ex "target extended-remote $device" -ex "monitor tpwr $option" -ex "quit"
